<!DOCTYPE html>
<html>
<head>
  <title>Transformer å·¥ä½œåŸç†å¯è§†åŒ–</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 0 auto; }
    .step { background: #f5f7fa; padding: 15px; margin: 10px 0; border-radius: 8px; }
    input, button { padding: 8px; margin: 5px; }
    #output { padding: 15px; background: #eef5ff; border-radius: 8px; }
    .token { display: inline-block; padding: 5px 10px; background: #4e8cff; color: white; border-radius: 4px; margin: 5px; }
    .vector { font-size: 12px; color: #666; }
  </style>
</head>
<body>
  <h1>ğŸ¤– Transformer å·¥ä½œåŸç†æ¼”ç¤º</h1>

  <div class="step">
    <h3>ç¬¬ 1 æ­¥ï¼šè¾“å…¥å¥å­</h3>
    <input type="text" id="inputText" value="çŒ« å–œæ¬¢ åƒ é±¼" placeholder="è¾“å…¥è¯è¯­ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼‰">
    <button onclick="processText()">å¼€å§‹å¤„ç†</button>
  </div>

  <div class="step" id="step2" style="display:none">
    <h3>ç¬¬ 2 æ­¥ï¼šè¯ â†’ å‘é‡ï¼ˆç¼–ç ï¼‰</h3>
    <p>æ¯ä¸ªè¯è¢«è½¬åŒ–ä¸ºæ•°å­—å‘é‡ï¼š</p>
    <div id="embeddingOutput"></div>
  </div>

  <div class="step" id="step3" style="display:none">
    <h3>ç¬¬ 3 æ­¥ï¼šä½ç½®ç¼–ç ï¼ˆåŠ é¡ºåºæ ‡è®°ï¼‰</h3>
    <p>ä¸ºæ¯ä¸ªå‘é‡æ·»åŠ ä½ç½®ç¼–ç ï¼š</p>
    <div id="positionOutput"></div>
  </div>

  <div class="step" id="step4" style="display:none">
    <h3>ç¬¬ 4 æ­¥ï¼šè‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆè¯è¯­ç¤¾äº¤ï¼‰</h3>
    <p>æ¯ä¸ªè¯æ ¹æ®å…¶ä»–è¯çš„å…³è”åº¦é‡æ–°è°ƒæ•´ï¼š</p>
    <div id="attentionOutput"></div>
  </div>

  <div class="step" id="step5" style="display:none">
    <h3>ç¬¬ 5 æ­¥ï¼šæœ€ç»ˆè¾“å‡ºï¼ˆç†è§£ä¸Šä¸‹æ–‡ï¼‰</h3>
    <p>è¯å‘é‡å·²è¢« Transformer æ›´æ–°ï¼ˆç»“åˆæ•´å¥å«ä¹‰ï¼‰ï¼š</p>
    <div id="finalOutput"></div>
  </div>

  <script>
    // æ¨¡æ‹Ÿå‘é‡ç”Ÿæˆï¼ˆå®é™…ä¸ºæ•°ç™¾ä½æ•°å­—ï¼Œè¿™é‡Œç®€åŒ–ä¸º3ä½ï¼‰
    function wordToVector(word) {
      // å®é™…æ¨¡å‹ä¼šä½¿ç”¨é¢„è®­ç»ƒçš„è¯åµŒå…¥
      const vectors = {
        "çŒ«": [0.8, -0.2, 0.5],
        "å–œæ¬¢": [-0.3, 0.7, 0.1],
        "åƒ": [0.1, 0.5, -0.9],
        "é±¼": [0.6, -0.4, 0.3]
      };
      return vectors[word] || [Math.random().toFixed(1), Math.random().toFixed(1), Math.random().toFixed(1)];
    }

    // æ¨¡æ‹Ÿä½ç½®ç¼–ç ï¼ˆå®é™…ä½¿ç”¨æ­£å¼¦å‡½æ•°ï¼‰
    function addPosition(vector, index) {
      const position = [index * 0.1, (index+1) * 0.2, (index+2) * 0.3];
      return vector.map((v, i) => (parseFloat(v) + position[i]).toFixed(1));
    }

    // æ¨¡æ‹Ÿè‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆç®€åŒ–ç‰ˆï¼‰
    function calculateAttention(vectors) {
      // å®é™…æ¨¡å‹ä½¿ç”¨ Q,K,V çŸ©é˜µè®¡ç®—
      return vectors.map(v => v.map(num => (parseFloat(num) * 1.5).toFixed(1)));
    }

    // ä¸»å¤„ç†å‡½æ•°
    function processText() {
      const input = document.getElementById("inputText").value.split(" ");
      showStep(2);
      
      // 1. è¯ â†’ å‘é‡
      const embeddings = input.map(word => wordToVector(word));
      displayResult(input, embeddings, "embeddingOutput", "#4e8cff");

      // 2. æ·»åŠ ä½ç½®ç¼–ç 
      setTimeout(() => {
        showStep(3);
        const positioned = embeddings.map((vec, i) => addPosition(vec, i));
        displayResult(input, positioned, "positionOutput", "#ff6b6b");
      }, 1500);

      // 3. è‡ªæ³¨æ„åŠ›è®¡ç®—
      setTimeout(() => {
        showStep(4);
        const attentionApplied = calculateAttention(embeddings);
        displayResult(input, attentionApplied, "attentionOutput", "#48db71");
      }, 3000);

      // 4. æœ€ç»ˆè¾“å‡º
      setTimeout(() => {
        showStep(5);
        displayResult(input, calculateAttention(positioned), "finalOutput", "#9b59b6");
      }, 4500);
    }

    // é€šç”¨æ˜¾ç¤ºå‡½æ•°
    function displayResult(words, vectors, elementId, color) {
      const container = document.getElementById(elementId);
      container.innerHTML = '';
      words.forEach((word, i) => {
        const div = document.createElement("div");
        div.innerHTML = `
          <span class="token" style="background: ${color}">${word}</span>
          <span class="vector">â†’ [${vectors[i].join(", ")}]</span>
        `;
        container.appendChild(div);
      });
    }

    function showStep(stepNum) {
      document.querySelectorAll(`.step`).forEach(el => el.style.display = 'none');
      document.getElementById(`step${stepNum}`).style.display = 'block';
    }
  </script>
</body>
</html>